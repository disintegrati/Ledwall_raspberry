# ledmatrix-scroll by Andrew Oakley www.aoakley.com Public Domain 2015-10-18
#
# Takes an image file (e.g. PNG) as command line argument and scrolls it
# across a grid of WS2811 addressable LEDs, repeated in a loop until CTRL-C
#
# Use a very wide image for good scrolling effect.
#
# If you have a low resolution matrix (like mine, 12x8 LEDs) then you will
# probably need to create your image height equal to your matrix height
# and draw lettering pixel by pixel (e..g in GIMP or mtpaint) if you want
# words or detail to be legible.

import time, sys, os, re
from neopixel import * # See https://learn.adafruit.com/neopixels-on-raspberry-pi/software
from PIL import Image  # Use apt-get install python-imaging to install this

# LED strip configuration:
LED_COUNT      = 4725      # Number of LED pixels.
LED_PIN        = 18      # GPIO pin connected to the pixels (must support PWM!).
LED_FREQ_HZ    = 800000  # LED signal frequency in hertz (usually 800khz)
LED_DMA        = 5       # DMA channel to use for generating signal (try 5)
LED_BRIGHTNESS = 10     # Set to 0 for darkest and 255 for brightest
LED_INVERT     = False   # True to invert the signal (when using NPN transistor level shift)

# Speed of movement, in seconds (recommend 0.1-0.3)
SPEED=0.0000001
# SPEED=100

# Size of your matrix
MATRIX_WIDTH=360
MATRIX_HEIGHT=15

# LED matrix layout
# A list converting LED string number to physical grid layout
# Start with top right and continue right then down
# For example, my string starts bottom right and has horizontal batons
# which loop on alternate rows.
#
# Mine ends at the top right here:     -----------\
# My last LED is number 95                        |
#                                      /----------/
#                                      |
#                                      \----------\
# The first LED is number 0                       |
# Mine starts at the bottom left here: -----------/ 

#myMatrix=[95,94,93,92,91,90,89,88,87,86,85,84,
#          72,73,74,75,76,77,78,79,80,81,82,83,
#          71,70,69,68,67,66,65,64,63,62,61,60,
#          48,49,50,51,52,53,54,55,56,57,58,59,
#          47,46,45,44,43,42,41,40,39,38,37,36,
#          24,25,26,27,28,29,30,31,32,33,34,35,
#          23,22,21,20,19,18,17,16,15,14,13,12,
#           0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11]


myMatrix=[
0,29,30,59,60,89,90,119,120,149,150,179,180,209,210,239,240,269,270,299,300,329,330,359,360,389,390,419,420,449,450,479,480,509,510,539,540,569,570,599,600,629,630,659,660,675,704,705,734,735,764,765,794,795,824,825,854,855,884,885,914,915,944,945,974,975,1004,1005,1034,1035,1064,1065,1094,1095,1124,1125,1154,1155,1184,1185,1214,1215,1244,1245,1274,1275,1304,1305,1334,1335,1350,1379,1380,1409,1410,1439,1440,1469,1470,1499,1500,1529,1530,1559,1560,1589,1590,1619,1620,1649,1650,1679,1680,1709,1710,1739,1740,1769,1770,1799,1800,1829,1830,1859,1860,1889,1890,1919,1920,1949,1950,1979,1980,2009,2010,2025,2054,2055,2084,2085,2114,2115,2144,2145,2174,2175,2204,2205,2234,2235,2264,2265,2294,2295,2324,2325,2354,2355,2384,2385,2414,2415,2444,2445,2474,2475,2504,2505,2534,2535,2564,2565,2594,2595,2624,2625,2654,2655,2684,2685,2700,2729,2730,2759,2760,2789,2790,2819,2820,2849,2850,2879,2880,2909,2910,2939,2940,2969,2970,2999,3000,3029,3030,3059,3060,3089,3090,3119,3120,3149,3150,3179,3180,3209,3210,3239,3240,3269,3270,3299,3300,3329,3330,3359,3360,3375,3404,3405,3434,3435,3464,3465,3494,3495,3524,3525,3554,3555,3584,3585,3614,3615,3644,3645,3674,3675,3704,3705,3734,3735,3764,3765,3794,3795,3824,3825,3854,3855,3884,3885,3914,3915,3944,3945,3974,3975,4004,4005,4034,4035,4050,4079,4080,4109,4110,4139,4140,4169,4170,4199,4200,4229,4230,4259,4260,4289,4290,4319,4320,4349,4350,4379,4380,4409,4410,4439,4440,4469,4470,4499,4500,4529,4530,4559,4560,4589,4590,4619,4620,4649,4650,4679,4680,4709,4710,4725,4754,4755,4784,4785,4814,4815,4844,4845,4874,4875,4904,4905,4934,4935,4964,4965,4994,4995,5024,5025,5054,5055,5084,5085,5114,5115,5144,5145,5174,5175,5204,5205,5234,5235,5264,5265,5294,5295,5324,5325,5354,5355,5384,5385,
1,28,31,58,61,88,91,118,121,148,151,178,181,208,211,238,241,268,271,298,301,328,331,358,361,388,391,418,421,448,451,478,481,508,511,538,541,568,571,598,601,628,631,658,661,676,703,706,733,736,763,766,793,796,823,826,853,856,883,886,913,916,943,946,973,976,1003,1006,1033,1036,1063,1066,1093,1096,1123,1126,1153,1156,1183,1186,1213,1216,1243,1246,1273,1276,1303,1306,1333,1336,1351,1378,1381,1408,1411,1438,1441,1468,1471,1498,1501,1528,1531,1558,1561,1588,1591,1618,1621,1648,1651,1678,1681,1708,1711,1738,1741,1768,1771,1798,1801,1828,1831,1858,1861,1888,1891,1918,1921,1948,1951,1978,1981,2008,2011,2026,2053,2056,2083,2086,2113,2116,2143,2146,2173,2176,2203,2206,2233,2236,2263,2266,2293,2296,2323,2326,2353,2356,2383,2386,2413,2416,2443,2446,2473,2476,2503,2506,2533,2536,2563,2566,2593,2596,2623,2626,2653,2656,2683,2686,2701,2728,2731,2758,2761,2788,2791,2818,2821,2848,2851,2878,2881,2908,2911,2938,2941,2968,2971,2998,3001,3028,3031,3058,3061,3088,3091,3118,3121,3148,3151,3178,3181,3208,3211,3238,3241,3268,3271,3298,3301,3328,3331,3358,3361,3376,3403,3406,3433,3436,3463,3466,3493,3496,3523,3526,3553,3556,3583,3586,3613,3616,3643,3646,3673,3676,3703,3706,3733,3736,3763,3766,3793,3796,3823,3826,3853,3856,3883,3886,3913,3916,3943,3946,3973,3976,4003,4006,4033,4036,4051,4078,4081,4108,4111,4138,4141,4168,4171,4198,4201,4228,4231,4258,4261,4288,4291,4318,4321,4348,4351,4378,4381,4408,4411,4438,4441,4468,4471,4498,4501,4528,4531,4558,4561,4588,4591,4618,4621,4648,4651,4678,4681,4708,4711,4726,4753,4756,4783,4786,4813,4816,4843,4846,4873,4876,4903,4906,4933,4936,4963,4966,4993,4996,5023,5026,5053,5056,5083,5086,5113,5116,5143,5146,5173,5176,5203,5206,5233,5236,5263,5266,5293,5296,5323,5326,5353,5356,5383,5386,
2,27,32,57,62,87,92,117,122,147,152,177,182,207,212,237,242,267,272,297,302,327,332,357,362,387,392,417,422,447,452,477,482,507,512,537,542,567,572,597,602,627,632,657,662,677,702,707,732,737,762,767,792,797,822,827,852,857,882,887,912,917,942,947,972,977,1002,1007,1032,1037,1062,1067,1092,1097,1122,1127,1152,1157,1182,1187,1212,1217,1242,1247,1272,1277,1302,1307,1332,1337,1352,1377,1382,1407,1412,1437,1442,1467,1472,1497,1502,1527,1532,1557,1562,1587,1592,1617,1622,1647,1652,1677,1682,1707,1712,1737,1742,1767,1772,1797,1802,1827,1832,1857,1862,1887,1892,1917,1922,1947,1952,1977,1982,2007,2012,2027,2052,2057,2082,2087,2112,2117,2142,2147,2172,2177,2202,2207,2232,2237,2262,2267,2292,2297,2322,2327,2352,2357,2382,2387,2412,2417,2442,2447,2472,2477,2502,2507,2532,2537,2562,2567,2592,2597,2622,2627,2652,2657,2682,2687,2702,2727,2732,2757,2762,2787,2792,2817,2822,2847,2852,2877,2882,2907,2912,2937,2942,2967,2972,2997,3002,3027,3032,3057,3062,3087,3092,3117,3122,3147,3152,3177,3182,3207,3212,3237,3242,3267,3272,3297,3302,3327,3332,3357,3362,3377,3402,3407,3432,3437,3462,3467,3492,3497,3522,3527,3552,3557,3582,3587,3612,3617,3642,3647,3672,3677,3702,3707,3732,3737,3762,3767,3792,3797,3822,3827,3852,3857,3882,3887,3912,3917,3942,3947,3972,3977,4002,4007,4032,4037,4052,4077,4082,4107,4112,4137,4142,4167,4172,4197,4202,4227,4232,4257,4262,4287,4292,4317,4322,4347,4352,4377,4382,4407,4412,4437,4442,4467,4472,4497,4502,4527,4532,4557,4562,4587,4592,4617,4622,4647,4652,4677,4682,4707,4712,4727,4752,4757,4782,4787,4812,4817,4842,4847,4872,4877,4902,4907,4932,4937,4962,4967,4992,4997,5022,5027,5052,5057,5082,5087,5112,5117,5142,5147,5172,5177,5202,5207,5232,5237,5262,5267,5292,5297,5322,5327,5352,5357,5382,5387,
3,26,33,56,63,86,93,116,123,146,153,176,183,206,213,236,243,266,273,296,303,326,333,356,363,386,393,416,423,446,453,476,483,506,513,536,543,566,573,596,603,626,633,656,663,678,701,708,731,738,761,768,791,798,821,828,851,858,881,888,911,918,941,948,971,978,1001,1008,1031,1038,1061,1068,1091,1098,1121,1128,1151,1158,1181,1188,1211,1218,1241,1248,1271,1278,1301,1308,1331,1338,1353,1376,1383,1406,1413,1436,1443,1466,1473,1496,1503,1526,1533,1556,1563,1586,1593,1616,1623,1646,1653,1676,1683,1706,1713,1736,1743,1766,1773,1796,1803,1826,1833,1856,1863,1886,1893,1916,1923,1946,1953,1976,1983,2006,2013,2028,2051,2058,2081,2088,2111,2118,2141,2148,2171,2178,2201,2208,2231,2238,2261,2268,2291,2298,2321,2328,2351,2358,2381,2388,2411,2418,2441,2448,2471,2478,2501,2508,2531,2538,2561,2568,2591,2598,2621,2628,2651,2658,2681,2688,2703,2726,2733,2756,2763,2786,2793,2816,2823,2846,2853,2876,2883,2906,2913,2936,2943,2966,2973,2996,3003,3026,3033,3056,3063,3086,3093,3116,3123,3146,3153,3176,3183,3206,3213,3236,3243,3266,3273,3296,3303,3326,3333,3356,3363,3378,3401,3408,3431,3438,3461,3468,3491,3498,3521,3528,3551,3558,3581,3588,3611,3618,3641,3648,3671,3678,3701,3708,3731,3738,3761,3768,3791,3798,3821,3828,3851,3858,3881,3888,3911,3918,3941,3948,3971,3978,4001,4008,4031,4038,4053,4076,4083,4106,4113,4136,4143,4166,4173,4196,4203,4226,4233,4256,4263,4286,4293,4316,4323,4346,4353,4376,4383,4406,4413,4436,4443,4466,4473,4496,4503,4526,4533,4556,4563,4586,4593,4616,4623,4646,4653,4676,4683,4706,4713,4728,4751,4758,4781,4788,4811,4818,4841,4848,4871,4878,4901,4908,4931,4938,4961,4968,4991,4998,5021,5028,5051,5058,5081,5088,5111,5118,5141,5148,5171,5178,5201,5208,5231,5238,5261,5268,5291,5298,5321,5328,5351,5358,5381,5388,
4,25,34,55,64,85,94,115,124,145,154,175,184,205,214,235,244,265,274,295,304,325,334,355,364,385,394,415,424,445,454,475,484,505,514,535,544,565,574,595,604,625,634,655,664,679,700,709,730,739,760,769,790,799,820,829,850,859,880,889,910,919,940,949,970,979,1000,1009,1030,1039,1060,1069,1090,1099,1120,1129,1150,1159,1180,1189,1210,1219,1240,1249,1270,1279,1300,1309,1330,1339,1354,1375,1384,1405,1414,1435,1444,1465,1474,1495,1504,1525,1534,1555,1564,1585,1594,1615,1624,1645,1654,1675,1684,1705,1714,1735,1744,1765,1774,1795,1804,1825,1834,1855,1864,1885,1894,1915,1924,1945,1954,1975,1984,2005,2014,2029,2050,2059,2080,2089,2110,2119,2140,2149,2170,2179,2200,2209,2230,2239,2260,2269,2290,2299,2320,2329,2350,2359,2380,2389,2410,2419,2440,2449,2470,2479,2500,2509,2530,2539,2560,2569,2590,2599,2620,2629,2650,2659,2680,2689,2704,2725,2734,2755,2764,2785,2794,2815,2824,2845,2854,2875,2884,2905,2914,2935,2944,2965,2974,2995,3004,3025,3034,3055,3064,3085,3094,3115,3124,3145,3154,3175,3184,3205,3214,3235,3244,3265,3274,3295,3304,3325,3334,3355,3364,3379,3400,3409,3430,3439,3460,3469,3490,3499,3520,3529,3550,3559,3580,3589,3610,3619,3640,3649,3670,3679,3700,3709,3730,3739,3760,3769,3790,3799,3820,3829,3850,3859,3880,3889,3910,3919,3940,3949,3970,3979,4000,4009,4030,4039,4054,4075,4084,4105,4114,4135,4144,4165,4174,4195,4204,4225,4234,4255,4264,4285,4294,4315,4324,4345,4354,4375,4384,4405,4414,4435,4444,4465,4474,4495,4504,4525,4534,4555,4564,4585,4594,4615,4624,4645,4654,4675,4684,4705,4714,4729,4750,4759,4780,4789,4810,4819,4840,4849,4870,4879,4900,4909,4930,4939,4960,4969,4990,4999,5020,5029,5050,5059,5080,5089,5110,5119,5140,5149,5170,5179,5200,5209,5230,5239,5260,5269,5290,5299,5320,5329,5350,5359,5380,5389,
5,24,35,54,65,84,95,114,125,144,155,174,185,204,215,234,245,264,275,294,305,324,335,354,365,384,395,414,425,444,455,474,485,504,515,534,545,564,575,594,605,624,635,654,665,680,699,710,729,740,759,770,789,800,819,830,849,860,879,890,909,920,939,950,969,980,999,1010,1029,1040,1059,1070,1089,1100,1119,1130,1149,1160,1179,1190,1209,1220,1239,1250,1269,1280,1299,1310,1329,1340,1355,1374,1385,1404,1415,1434,1445,1464,1475,1494,1505,1524,1535,1554,1565,1584,1595,1614,1625,1644,1655,1674,1685,1704,1715,1734,1745,1764,1775,1794,1805,1824,1835,1854,1865,1884,1895,1914,1925,1944,1955,1974,1985,2004,2015,2030,2049,2060,2079,2090,2109,2120,2139,2150,2169,2180,2199,2210,2229,2240,2259,2270,2289,2300,2319,2330,2349,2360,2379,2390,2409,2420,2439,2450,2469,2480,2499,2510,2529,2540,2559,2570,2589,2600,2619,2630,2649,2660,2679,2690,2705,2724,2735,2754,2765,2784,2795,2814,2825,2844,2855,2874,2885,2904,2915,2934,2945,2964,2975,2994,3005,3024,3035,3054,3065,3084,3095,3114,3125,3144,3155,3174,3185,3204,3215,3234,3245,3264,3275,3294,3305,3324,3335,3354,3365,3380,3399,3410,3429,3440,3459,3470,3489,3500,3519,3530,3549,3560,3579,3590,3609,3620,3639,3650,3669,3680,3699,3710,3729,3740,3759,3770,3789,3800,3819,3830,3849,3860,3879,3890,3909,3920,3939,3950,3969,3980,3999,4010,4029,4040,4055,4074,4085,4104,4115,4134,4145,4164,4175,4194,4205,4224,4235,4254,4265,4284,4295,4314,4325,4344,4355,4374,4385,4404,4415,4434,4445,4464,4475,4494,4505,4524,4535,4554,4565,4584,4595,4614,4625,4644,4655,4674,4685,4704,4715,4730,4749,4760,4779,4790,4809,4820,4839,4850,4869,4880,4899,4910,4929,4940,4959,4970,4989,5000,5019,5030,5049,5060,5079,5090,5109,5120,5139,5150,5169,5180,5199,5210,5229,5240,5259,5270,5289,5300,5319,5330,5349,5360,5379,5390,
6,23,36,53,66,83,96,113,126,143,156,173,186,203,216,233,246,263,276,293,306,323,336,353,366,383,396,413,426,443,456,473,486,503,516,533,546,563,576,593,606,623,636,653,666,681,698,711,728,741,758,771,788,801,818,831,848,861,878,891,908,921,938,951,968,981,998,1011,1028,1041,1058,1071,1088,1101,1118,1131,1148,1161,1178,1191,1208,1221,1238,1251,1268,1281,1298,1311,1328,1341,1356,1373,1386,1403,1416,1433,1446,1463,1476,1493,1506,1523,1536,1553,1566,1583,1596,1613,1626,1643,1656,1673,1686,1703,1716,1733,1746,1763,1776,1793,1806,1823,1836,1853,1866,1883,1896,1913,1926,1943,1956,1973,1986,2003,2016,2031,2048,2061,2078,2091,2108,2121,2138,2151,2168,2181,2198,2211,2228,2241,2258,2271,2288,2301,2318,2331,2348,2361,2378,2391,2408,2421,2438,2451,2468,2481,2498,2511,2528,2541,2558,2571,2588,2601,2618,2631,2648,2661,2678,2691,2706,2723,2736,2753,2766,2783,2796,2813,2826,2843,2856,2873,2886,2903,2916,2933,2946,2963,2976,2993,3006,3023,3036,3053,3066,3083,3096,3113,3126,3143,3156,3173,3186,3203,3216,3233,3246,3263,3276,3293,3306,3323,3336,3353,3366,3381,3398,3411,3428,3441,3458,3471,3488,3501,3518,3531,3548,3561,3578,3591,3608,3621,3638,3651,3668,3681,3698,3711,3728,3741,3758,3771,3788,3801,3818,3831,3848,3861,3878,3891,3908,3921,3938,3951,3968,3981,3998,4011,4028,4041,4056,4073,4086,4103,4116,4133,4146,4163,4176,4193,4206,4223,4236,4253,4266,4283,4296,4313,4326,4343,4356,4373,4386,4403,4416,4433,4446,4463,4476,4493,4506,4523,4536,4553,4566,4583,4596,4613,4626,4643,4656,4673,4686,4703,4716,4731,4748,4761,4778,4791,4808,4821,4838,4851,4868,4881,4898,4911,4928,4941,4958,4971,4988,5001,5018,5031,5048,5061,5078,5091,5108,5121,5138,5151,5168,5181,5198,5211,5228,5241,5258,5271,5288,5301,5318,5331,5348,5361,5378,5391,
7,22,37,52,67,82,97,112,127,142,157,172,187,202,217,232,247,262,277,292,307,322,337,352,367,382,397,412,427,442,457,472,487,502,517,532,547,562,577,592,607,622,637,652,667,682,697,712,727,742,757,772,787,802,817,832,847,862,877,892,907,922,937,952,967,982,997,1012,1027,1042,1057,1072,1087,1102,1117,1132,1147,1162,1177,1192,1207,1222,1237,1252,1267,1282,1297,1312,1327,1342,1357,1372,1387,1402,1417,1432,1447,1462,1477,1492,1507,1522,1537,1552,1567,1582,1597,1612,1627,1642,1657,1672,1687,1702,1717,1732,1747,1762,1777,1792,1807,1822,1837,1852,1867,1882,1897,1912,1927,1942,1957,1972,1987,2002,2017,2032,2047,2062,2077,2092,2107,2122,2137,2152,2167,2182,2197,2212,2227,2242,2257,2272,2287,2302,2317,2332,2347,2362,2377,2392,2407,2422,2437,2452,2467,2482,2497,2512,2527,2542,2557,2572,2587,2602,2617,2632,2647,2662,2677,2692,2707,2722,2737,2752,2767,2782,2797,2812,2827,2842,2857,2872,2887,2902,2917,2932,2947,2962,2977,2992,3007,3022,3037,3052,3067,3082,3097,3112,3127,3142,3157,3172,3187,3202,3217,3232,3247,3262,3277,3292,3307,3322,3337,3352,3367,3382,3397,3412,3427,3442,3457,3472,3487,3502,3517,3532,3547,3562,3577,3592,3607,3622,3637,3652,3667,3682,3697,3712,3727,3742,3757,3772,3787,3802,3817,3832,3847,3862,3877,3892,3907,3922,3937,3952,3967,3982,3997,4012,4027,4042,4057,4072,4087,4102,4117,4132,4147,4162,4177,4192,4207,4222,4237,4252,4267,4282,4297,4312,4327,4342,4357,4372,4387,4402,4417,4432,4447,4462,4477,4492,4507,4522,4537,4552,4567,4582,4597,4612,4627,4642,4657,4672,4687,4702,4717,4732,4747,4762,4777,4792,4807,4822,4837,4852,4867,4882,4897,4912,4927,4942,4957,4972,4987,5002,5017,5032,5047,5062,5077,5092,5107,5122,5137,5152,5167,5182,5197,5212,5227,5242,5257,5272,5287,5302,5317,5332,5347,5362,5377,5392,
8,21,38,51,68,81,98,111,128,141,158,171,188,201,218,231,248,261,278,291,308,321,338,351,368,381,398,411,428,441,458,471,488,501,518,531,548,561,578,591,608,621,638,651,668,683,696,713,726,743,756,773,786,803,816,833,846,863,876,893,906,923,936,953,966,983,996,1013,1026,1043,1056,1073,1086,1103,1116,1133,1146,1163,1176,1193,1206,1223,1236,1253,1266,1283,1296,1313,1326,1343,1358,1371,1388,1401,1418,1431,1448,1461,1478,1491,1508,1521,1538,1551,1568,1581,1598,1611,1628,1641,1658,1671,1688,1701,1718,1731,1748,1761,1778,1791,1808,1821,1838,1851,1868,1881,1898,1911,1928,1941,1958,1971,1988,2001,2018,2033,2046,2063,2076,2093,2106,2123,2136,2153,2166,2183,2196,2213,2226,2243,2256,2273,2286,2303,2316,2333,2346,2363,2376,2393,2406,2423,2436,2453,2466,2483,2496,2513,2526,2543,2556,2573,2586,2603,2616,2633,2646,2663,2676,2693,2708,2721,2738,2751,2768,2781,2798,2811,2828,2841,2858,2871,2888,2901,2918,2931,2948,2961,2978,2991,3008,3021,3038,3051,3068,3081,3098,3111,3128,3141,3158,3171,3188,3201,3218,3231,3248,3261,3278,3291,3308,3321,3338,3351,3368,3383,3396,3413,3426,3443,3456,3473,3486,3503,3516,3533,3546,3563,3576,3593,3606,3623,3636,3653,3666,3683,3696,3713,3726,3743,3756,3773,3786,3803,3816,3833,3846,3863,3876,3893,3906,3923,3936,3953,3966,3983,3996,4013,4026,4043,4058,4071,4088,4101,4118,4131,4148,4161,4178,4191,4208,4221,4238,4251,4268,4281,4298,4311,4328,4341,4358,4371,4388,4401,4418,4431,4448,4461,4478,4491,4508,4521,4538,4551,4568,4581,4598,4611,4628,4641,4658,4671,4688,4701,4718,4733,4746,4763,4776,4793,4806,4823,4836,4853,4866,4883,4896,4913,4926,4943,4956,4973,4986,5003,5016,5033,5046,5063,5076,5093,5106,5123,5136,5153,5166,5183,5196,5213,5226,5243,5256,5273,5286,5303,5316,5333,5346,5363,5376,5393,
9,20,39,50,69,80,99,110,129,140,159,170,189,200,219,230,249,260,279,290,309,320,339,350,369,380,399,410,429,440,459,470,489,500,519,530,549,560,579,590,609,620,639,650,669,684,695,714,725,744,755,774,785,804,815,834,845,864,875,894,905,924,935,954,965,984,995,1014,1025,1044,1055,1074,1085,1104,1115,1134,1145,1164,1175,1194,1205,1224,1235,1254,1265,1284,1295,1314,1325,1344,1359,1370,1389,1400,1419,1430,1449,1460,1479,1490,1509,1520,1539,1550,1569,1580,1599,1610,1629,1640,1659,1670,1689,1700,1719,1730,1749,1760,1779,1790,1809,1820,1839,1850,1869,1880,1899,1910,1929,1940,1959,1970,1989,2000,2019,2034,2045,2064,2075,2094,2105,2124,2135,2154,2165,2184,2195,2214,2225,2244,2255,2274,2285,2304,2315,2334,2345,2364,2375,2394,2405,2424,2435,2454,2465,2484,2495,2514,2525,2544,2555,2574,2585,2604,2615,2634,2645,2664,2675,2694,2709,2720,2739,2750,2769,2780,2799,2810,2829,2840,2859,2870,2889,2900,2919,2930,2949,2960,2979,2990,3009,3020,3039,3050,3069,3080,3099,3110,3129,3140,3159,3170,3189,3200,3219,3230,3249,3260,3279,3290,3309,3320,3339,3350,3369,3384,3395,3414,3425,3444,3455,3474,3485,3504,3515,3534,3545,3564,3575,3594,3605,3624,3635,3654,3665,3684,3695,3714,3725,3744,3755,3774,3785,3804,3815,3834,3845,3864,3875,3894,3905,3924,3935,3954,3965,3984,3995,4014,4025,4044,4059,4070,4089,4100,4119,4130,4149,4160,4179,4190,4209,4220,4239,4250,4269,4280,4299,4310,4329,4340,4359,4370,4389,4400,4419,4430,4449,4460,4479,4490,4509,4520,4539,4550,4569,4580,4599,4610,4629,4640,4659,4670,4689,4700,4719,4734,4745,4764,4775,4794,4805,4824,4835,4854,4865,4884,4895,4914,4925,4944,4955,4974,4985,5004,5015,5034,5045,5064,5075,5094,5105,5124,5135,5154,5165,5184,5195,5214,5225,5244,5255,5274,5285,5304,5315,5334,5345,5364,5375,5394,
10,19,40,49,70,79,100,109,130,139,160,169,190,199,220,229,250,259,280,289,310,319,340,349,370,379,400,409,430,439,460,469,490,499,520,529,550,559,580,589,610,619,640,649,670,685,694,715,724,745,754,775,784,805,814,835,844,865,874,895,904,925,934,955,964,985,994,1015,1024,1045,1054,1075,1084,1105,1114,1135,1144,1165,1174,1195,1204,1225,1234,1255,1264,1285,1294,1315,1324,1345,1360,1369,1390,1399,1420,1429,1450,1459,1480,1489,1510,1519,1540,1549,1570,1579,1600,1609,1630,1639,1660,1669,1690,1699,1720,1729,1750,1759,1780,1789,1810,1819,1840,1849,1870,1879,1900,1909,1930,1939,1960,1969,1990,1999,2020,2035,2044,2065,2074,2095,2104,2125,2134,2155,2164,2185,2194,2215,2224,2245,2254,2275,2284,2305,2314,2335,2344,2365,2374,2395,2404,2425,2434,2455,2464,2485,2494,2515,2524,2545,2554,2575,2584,2605,2614,2635,2644,2665,2674,2695,2710,2719,2740,2749,2770,2779,2800,2809,2830,2839,2860,2869,2890,2899,2920,2929,2950,2959,2980,2989,3010,3019,3040,3049,3070,3079,3100,3109,3130,3139,3160,3169,3190,3199,3220,3229,3250,3259,3280,3289,3310,3319,3340,3349,3370,3385,3394,3415,3424,3445,3454,3475,3484,3505,3514,3535,3544,3565,3574,3595,3604,3625,3634,3655,3664,3685,3694,3715,3724,3745,3754,3775,3784,3805,3814,3835,3844,3865,3874,3895,3904,3925,3934,3955,3964,3985,3994,4015,4024,4045,4060,4069,4090,4099,4120,4129,4150,4159,4180,4189,4210,4219,4240,4249,4270,4279,4300,4309,4330,4339,4360,4369,4390,4399,4420,4429,4450,4459,4480,4489,4510,4519,4540,4549,4570,4579,4600,4609,4630,4639,4660,4669,4690,4699,4720,4735,4744,4765,4774,4795,4804,4825,4834,4855,4864,4885,4894,4915,4924,4945,4954,4975,4984,5005,5014,5035,5044,5065,5074,5095,5104,5125,5134,5155,5164,5185,5194,5215,5224,5245,5254,5275,5284,5305,5314,5335,5344,5365,5374,5395,
11,18,41,48,71,78,101,108,131,138,161,168,191,198,221,228,251,258,281,288,311,318,341,348,371,378,401,408,431,438,461,468,491,498,521,528,551,558,581,588,611,618,641,648,671,686,693,716,723,746,753,776,783,806,813,836,843,866,873,896,903,926,933,956,963,986,993,1016,1023,1046,1053,1076,1083,1106,1113,1136,1143,1166,1173,1196,1203,1226,1233,1256,1263,1286,1293,1316,1323,1346,1361,1368,1391,1398,1421,1428,1451,1458,1481,1488,1511,1518,1541,1548,1571,1578,1601,1608,1631,1638,1661,1668,1691,1698,1721,1728,1751,1758,1781,1788,1811,1818,1841,1848,1871,1878,1901,1908,1931,1938,1961,1968,1991,1998,2021,2036,2043,2066,2073,2096,2103,2126,2133,2156,2163,2186,2193,2216,2223,2246,2253,2276,2283,2306,2313,2336,2343,2366,2373,2396,2403,2426,2433,2456,2463,2486,2493,2516,2523,2546,2553,2576,2583,2606,2613,2636,2643,2666,2673,2696,2711,2718,2741,2748,2771,2778,2801,2808,2831,2838,2861,2868,2891,2898,2921,2928,2951,2958,2981,2988,3011,3018,3041,3048,3071,3078,3101,3108,3131,3138,3161,3168,3191,3198,3221,3228,3251,3258,3281,3288,3311,3318,3341,3348,3371,3386,3393,3416,3423,3446,3453,3476,3483,3506,3513,3536,3543,3566,3573,3596,3603,3626,3633,3656,3663,3686,3693,3716,3723,3746,3753,3776,3783,3806,3813,3836,3843,3866,3873,3896,3903,3926,3933,3956,3963,3986,3993,4016,4023,4046,4061,4068,4091,4098,4121,4128,4151,4158,4181,4188,4211,4218,4241,4248,4271,4278,4301,4308,4331,4338,4361,4368,4391,4398,4421,4428,4451,4458,4481,4488,4511,4518,4541,4548,4571,4578,4601,4608,4631,4638,4661,4668,4691,4698,4721,4736,4743,4766,4773,4796,4803,4826,4833,4856,4863,4886,4893,4916,4923,4946,4953,4976,4983,5006,5013,5036,5043,5066,5073,5096,5103,5126,5133,5156,5163,5186,5193,5216,5223,5246,5253,5276,5283,5306,5313,5336,5343,5366,5373,5396,
12,17,42,47,72,77,102,107,132,137,162,167,192,197,222,227,252,257,282,287,312,317,342,347,372,377,402,407,432,437,462,467,492,497,522,527,552,557,582,587,612,617,642,647,672,687,692,717,722,747,752,777,782,807,812,837,842,867,872,897,902,927,932,957,962,987,992,1017,1022,1047,1052,1077,1082,1107,1112,1137,1142,1167,1172,1197,1202,1227,1232,1257,1262,1287,1292,1317,1322,1347,1362,1367,1392,1397,1422,1427,1452,1457,1482,1487,1512,1517,1542,1547,1572,1577,1602,1607,1632,1637,1662,1667,1692,1697,1722,1727,1752,1757,1782,1787,1812,1817,1842,1847,1872,1877,1902,1907,1932,1937,1962,1967,1992,1997,2022,2037,2042,2067,2072,2097,2102,2127,2132,2157,2162,2187,2192,2217,2222,2247,2252,2277,2282,2307,2312,2337,2342,2367,2372,2397,2402,2427,2432,2457,2462,2487,2492,2517,2522,2547,2552,2577,2582,2607,2612,2637,2642,2667,2672,2697,2712,2717,2742,2747,2772,2777,2802,2807,2832,2837,2862,2867,2892,2897,2922,2927,2952,2957,2982,2987,3012,3017,3042,3047,3072,3077,3102,3107,3132,3137,3162,3167,3192,3197,3222,3227,3252,3257,3282,3287,3312,3317,3342,3347,3372,3387,3392,3417,3422,3447,3452,3477,3482,3507,3512,3537,3542,3567,3572,3597,3602,3627,3632,3657,3662,3687,3692,3717,3722,3747,3752,3777,3782,3807,3812,3837,3842,3867,3872,3897,3902,3927,3932,3957,3962,3987,3992,4017,4022,4047,4062,4067,4092,4097,4122,4127,4152,4157,4182,4187,4212,4217,4242,4247,4272,4277,4302,4307,4332,4337,4362,4367,4392,4397,4422,4427,4452,4457,4482,4487,4512,4517,4542,4547,4572,4577,4602,4607,4632,4637,4662,4667,4692,4697,4722,4737,4742,4767,4772,4797,4802,4827,4832,4857,4862,4887,4892,4917,4922,4947,4952,4977,4982,5007,5012,5037,5042,5067,5072,5097,5102,5127,5132,5157,5162,5187,5192,5217,5222,5247,5252,5277,5282,5307,5312,5337,5342,5367,5372,5397,
13,16,43,46,73,76,103,106,133,136,163,166,193,196,223,226,253,256,283,286,313,316,343,346,373,376,403,406,433,436,463,466,493,496,523,526,553,556,583,586,613,616,643,646,673,688,691,718,721,748,751,778,781,808,811,838,841,868,871,898,901,928,931,958,961,988,991,1018,1021,1048,1051,1078,1081,1108,1111,1138,1141,1168,1171,1198,1201,1228,1231,1258,1261,1288,1291,1318,1321,1348,1363,1366,1393,1396,1423,1426,1453,1456,1483,1486,1513,1516,1543,1546,1573,1576,1603,1606,1633,1636,1663,1666,1693,1696,1723,1726,1753,1756,1783,1786,1813,1816,1843,1846,1873,1876,1903,1906,1933,1936,1963,1966,1993,1996,2023,2038,2041,2068,2071,2098,2101,2128,2131,2158,2161,2188,2191,2218,2221,2248,2251,2278,2281,2308,2311,2338,2341,2368,2371,2398,2401,2428,2431,2458,2461,2488,2491,2518,2521,2548,2551,2578,2581,2608,2611,2638,2641,2668,2671,2698,2713,2716,2743,2746,2773,2776,2803,2806,2833,2836,2863,2866,2893,2896,2923,2926,2953,2956,2983,2986,3013,3016,3043,3046,3073,3076,3103,3106,3133,3136,3163,3166,3193,3196,3223,3226,3253,3256,3283,3286,3313,3316,3343,3346,3373,3388,3391,3418,3421,3448,3451,3478,3481,3508,3511,3538,3541,3568,3571,3598,3601,3628,3631,3658,3661,3688,3691,3718,3721,3748,3751,3778,3781,3808,3811,3838,3841,3868,3871,3898,3901,3928,3931,3958,3961,3988,3991,4018,4021,4048,4063,4066,4093,4096,4123,4126,4153,4156,4183,4186,4213,4216,4243,4246,4273,4276,4303,4306,4333,4336,4363,4366,4393,4396,4423,4426,4453,4456,4483,4486,4513,4516,4543,4546,4573,4576,4603,4606,4633,4636,4663,4666,4693,4696,4723,4738,4741,4768,4771,4798,4801,4828,4831,4858,4861,4888,4891,4918,4921,4948,4951,4978,4981,5008,5011,5038,5041,5068,5071,5098,5101,5128,5131,5158,5161,5188,5191,5218,5221,5248,5251,5278,5281,5308,5311,5338,5341,5368,5371,5398,
14,15,44,45,74,75,104,105,134,135,164,165,194,195,224,225,254,255,284,285,314,315,344,345,374,375,404,405,434,435,464,465,494,495,524,525,554,555,584,585,614,615,644,645,674,689,690,719,720,749,750,779,780,809,810,839,840,869,870,899,900,929,930,959,960,989,990,1019,1020,1049,1050,1079,1080,1109,1110,1139,1140,1169,1170,1199,1200,1229,1230,1259,1260,1289,1290,1319,1320,1349,1364,1365,1394,1395,1424,1425,1454,1455,1484,1485,1514,1515,1544,1545,1574,1575,1604,1605,1634,1635,1664,1665,1694,1695,1724,1725,1754,1755,1784,1785,1814,1815,1844,1845,1874,1875,1904,1905,1934,1935,1964,1965,1994,1995,2024,2039,2040,2069,2070,2099,2100,2129,2130,2159,2160,2189,2190,2219,2220,2249,2250,2279,2280,2309,2310,2339,2340,2369,2370,2399,2400,2429,2430,2459,2460,2489,2490,2519,2520,2549,2550,2579,2580,2609,2610,2639,2640,2669,2670,2699,2714,2715,2744,2745,2774,2775,2804,2805,2834,2835,2864,2865,2894,2895,2924,2925,2954,2955,2984,2985,3014,3015,3044,3045,3074,3075,3104,3105,3134,3135,3164,3165,3194,3195,3224,3225,3254,3255,3284,3285,3314,3315,3344,3345,3374,3389,3390,3419,3420,3449,3450,3479,3480,3509,3510,3539,3540,3569,3570,3599,3600,3629,3630,3659,3660,3689,3690,3719,3720,3749,3750,3779,3780,3809,3810,3839,3840,3869,3870,3899,3900,3929,3930,3959,3960,3989,3990,4019,4020,4049,4064,4065,4094,4095,4124,4125,4154,4155,4184,4185,4214,4215,4244,4245,4274,4275,4304,4305,4334,4335,4364,4365,4394,4395,4424,4425,4454,4455,4484,4485,4514,4515,4544,4545,4574,4575,4604,4605,4634,4635,4664,4665,4694,4695,4724,4739,4740,4769,4770,4799,4800,4829,4830,4859,4860,4889,4890,4919,4920,4949,4950,4979,4980,5009,5010,5039,5040,5069,5070,5099,5100,5129,5130,5159,5160,5189,5190,5219,5220,5249,5250,5279,5280,5309,5310,5339,5340,5369,5370,5399,


]

# I also used an 74AHCT125 level shifter & 10 amp 5V PSU
# Good build tutorial here:
# https://learn.adafruit.com/neopixels-on-raspberry-pi?view=all

# Check that we have sensible width & height
if MATRIX_WIDTH * MATRIX_HEIGHT != len(myMatrix):
  raise Exception("Matrix width x height does not equal length of myMatrix")

def allonecolour(strip,colour):
  # Paint the entire matrix one colour
  for i in range(strip.numPixels()):
    strip.setPixelColor(i,colour)
  strip.show()

def colour(r,g,b):
  # Fix for Neopixel RGB->GRB, also British spelling
  return Color(g,r,b)

def colourTuple(rgbTuple):
  return Color(rgbTuple[0],rgbTuple[1],rgbTuple[2])

def initLeds(strip):
  # Intialize the library (must be called once before other functions).
  strip.begin()
  # Wake up the LEDs by briefly setting them all to white
  allonecolour(strip,colour(255,255,255))
  time.sleep(0.01)

# Open the image file given as the command line parameter
try:
  loadIm=Image.open(sys.argv[1])
except:
  if len(sys.argv)==0:
    raise Exception("Please provide an image filename as a parameter.")
  else:
    raise Exception("Image file %s could not be loaded" % sys.argv[1])

# If the image height doesn't match the matrix, resize it
if loadIm.size[1] != MATRIX_HEIGHT:
  origIm=loadIm.resize((loadIm.size[0]/(loadIm.size[1]//MATRIX_HEIGHT),MATRIX_HEIGHT),Image.BICUBIC)
else:
  origIm=loadIm.copy()
# If the input is a very small portrait image, then no amount of resizing will save us
if origIm.size[0] < MATRIX_WIDTH:
  raise Exception("Picture is too narrow. Must be at least %s pixels wide" % MATRIX_WIDTH)

# Check if there's an accompanying .txt file which tells us
# how the user wants the image animated
# Commands available are:
# NNNN speed S.SSS
#   Set the scroll speed (in seconds)
#   Example: 0000 speed 0.150
#   At position zero (first position), set the speed to 150ms
# NNNN hold S.SSS
#   Hold the frame still (in seconds)
#   Example: 0011 hold 2.300
#   At position 11, keep the image still for 2.3 seconds
# NNNN-PPPP flip S.SSS
#   Animate MATRIX_WIDTH frames, like a flipbook
#   with a speed of S.SSS seconds between each frame
#   Example: 0014-0049 flip 0.100
#   From position 14, animate with 100ms between frames
#   until you reach or go past position 49
#   Note that this will jump positions MATRIX_WIDTH at a time
#   Takes a bit of getting used to - experiment
# NNNN jump PPPP
#   Jump to position PPPP
#   Example: 0001 jump 0200
#   At position 1, jump to position 200
#   Useful for debugging only - the image will loop anyway
txtlines=[]
match=re.search( r'^(?P<base>.*)\.[^\.]+$', sys.argv[1], re.M|re.I)
if match:
  txtfile=match.group('base')+'.txt'
  if os.path.isfile(txtfile):
    print "Found text file %s" % (txtfile)
    f=open(txtfile,'r')
    txtlines=f.readlines()
    f.close()

# Add a copy of the start of the image, to the end of the image,
# so that it loops smoothly at the end of the image
im=Image.new('RGB',(origIm.size[0]+MATRIX_WIDTH,MATRIX_HEIGHT))
im.paste(origIm,(0,0,origIm.size[0],MATRIX_HEIGHT))
im.paste(origIm.crop((0,0,MATRIX_WIDTH,MATRIX_HEIGHT)),(origIm.size[0],0,origIm.size[0]+MATRIX_WIDTH,MATRIX_HEIGHT))

# Create NeoPixel object with appropriate configuration.
strip = Adafruit_NeoPixel(LED_COUNT, LED_PIN, LED_FREQ_HZ, LED_DMA, LED_INVERT, LED_BRIGHTNESS)
initLeds(strip)

# And here we go.
try:
  while(True):

    # Loop through the image widthways
    # Can't use a for loop because Python is dumb
    # and won't jump values for FLIP command
    x=0
    # Initialise a pointer for the current line in the text file
    tx=0

    while x<im.size[0]-MATRIX_WIDTH:

      # Set the sleep period for this frame
      # This might get changed by a textfile command
      thissleep=SPEED

      # Set the increment for this frame
      # Typically advance 1 pixel at a time but
      # the FLIP command can change this
      thisincrement=1

      rg=im.crop((x,0,x+MATRIX_WIDTH,MATRIX_HEIGHT))
      dots=list(rg.getdata())
  
      for i in range(len(dots)):
        strip.setPixelColor(myMatrix[i],colourTuple(dots[i]))
      strip.show()

      # Check for instructions from the text file
      if tx<len(txtlines):
        match = re.search( r'^(?P<start>\s*\d+)(-(?P<finish>\d+))?\s+((?P<command>\S+)(\s+(?P<param>\d+(\.\d+)?))?)$', txtlines[tx], re.M|re.I)
        if match:
          print "Found valid command line %d:\n%s" % (tx,txtlines[tx])
          st=int(match.group('start'))
          fi=st
          print "Current pixel %05d start %05d finish %05d" % (x,st,fi)
          if match.group('finish'):
            fi=int(match.group('finish'))
          if x>=st and tx<=fi:
            if match.group('command').lower()=='speed':
              SPEED=float(match.group('param'))
              thissleep=SPEED
              print "Position %d : Set speed to %.3f secs per frame" % (x,thissleep)
            elif match.group('command').lower()=='flip':
              thissleep=float(match.group('param'))
              thisincrement=MATRIX_WIDTH
              print "Position %d: Flip for %.3f secs" % (x,thissleep)
            elif match.group('command').lower()=='hold':
              thissleep=float(match.group('param'))
              print "Position %d: Hold for %.3f secs" % (x,thissleep)
            elif match.group('command').lower()=='jump':
              print "Position %d: Jump to position %s" % (x,match.group('param'))
              x=int(match.group('param'))
              thisincrement=0
          # Move to the next line of the text file
          # only if we have completed all pixels in range
          if x>=fi:
            tx=tx+1
        else:
          print "Found INVALID command line %d:\n%s" % (tx,txtlines[tx])
          tx=tx+1

      x=x+thisincrement
      time.sleep(thissleep)

except (KeyboardInterrupt, SystemExit):
  print "Stopped"
  allonecolour(strip,colour(0,0,0))
